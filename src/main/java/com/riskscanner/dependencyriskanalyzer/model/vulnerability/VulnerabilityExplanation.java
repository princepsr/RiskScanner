package com.riskscanner.dependencyriskanalyzer.model.vulnerability;

import java.time.Instant;
import java.util.List;

/**
 * Represents an AI-generated explanation of a vulnerability finding.
 *
 * <p>Contains human-friendly explanations of why a vulnerability exists,
 * its real-world impact, and remediation options. All AI-generated content
 * is clearly marked as advisory.
 */
public class VulnerabilityExplanation {

    private final String vulnerabilityFindingId;
    private final String whyItExists;
    private final String realWorldImpact;
    private final String exploitationScenario;
    private final List<String> remediationOptions;
    private final String priorityRecommendation;
    private final String additionalContext;
    private final String explanationType;
    private final Instant generatedAt;

    public VulnerabilityExplanation(String vulnerabilityFindingId, String whyItExists, String realWorldImpact,
                                  String exploitationScenario, List<String> remediationOptions,
                                  String priorityRecommendation, String additionalContext,
                                  String explanationType, Instant generatedAt) {
        this.vulnerabilityFindingId = vulnerabilityFindingId;
        this.whyItExists = whyItExists;
        this.realWorldImpact = realWorldImpact;
        this.exploitationScenario = exploitationScenario;
        this.remediationOptions = List.copyOf(remediationOptions);
        this.priorityRecommendation = priorityRecommendation;
        this.additionalContext = additionalContext;
        this.explanationType = explanationType;
        this.generatedAt = generatedAt;
    }

    /**
     * Gets the ID of the vulnerability finding this explains.
     */
    public String getVulnerabilityFindingId() {
        return vulnerabilityFindingId;
    }

    /**
     * Gets the explanation of why this vulnerability exists.
     */
    public String getWhyItExists() {
        return whyItExists;
    }

    /**
     * Gets the description of real-world impact.
     */
    public String getRealWorldImpact() {
        return realWorldImpact;
    }

    /**
     * Gets the exploitation scenario.
     */
    public String getExploitationScenario() {
        return exploitationScenario;
    }

    /**
     * Gets the list of remediation options.
     */
    public List<String> getRemediationOptions() {
        return remediationOptions;
    }

    /**
     * Gets the priority recommendation.
     */
    public String getPriorityRecommendation() {
        return priorityRecommendation;
    }

    /**
     * Gets additional context information.
     */
    public String getAdditionalContext() {
        return additionalContext;
    }

    /**
     * Gets the type of explanation (AI-generated, fallback, etc.).
     */
    public String getExplanationType() {
        return explanationType;
    }

    /**
     * Gets when this explanation was generated.
     */
    public Instant getGeneratedAt() {
        return generatedAt;
    }

    /**
     * Checks if this is an AI-generated explanation.
     */
    public boolean isAiGenerated() {
        return explanationType.contains("AI");
    }

    /**
     * Gets a summary of the explanation for display purposes.
     */
    public String getSummary() {
        if (realWorldImpact.length() > 100) {
            return realWorldImpact.substring(0, 97) + "...";
        }
        return realWorldImpact;
    }

    @Override
    public String toString() {
        return String.format("VulnerabilityExplanation{findingId='%s', type='%s', impact='%s'}",
            vulnerabilityFindingId, explanationType, getSummary());
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;

        VulnerabilityExplanation that = (VulnerabilityExplanation) o;
        return vulnerabilityFindingId.equals(that.vulnerabilityFindingId);
    }

    @Override
    public int hashCode() {
        return vulnerabilityFindingId.hashCode();
    }
}
