<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Risk Scanner</title>
  <meta name="description" content="Dependency Vulnerability Analysis for Java Projects">
  <link rel="stylesheet" href="/styles.css">
</head>

<body>
  <div class="app-shell">
    <header class="app-header" role="banner">
      <div class="app-header__inner">
        <div class="app-header__brand">
          <h1 class="app-header__title">Risk Scanner</h1>
          <p class="app-header__subtitle">Dependency Vulnerability Analysis for Java Projects</p>
        </div>
        <div class="app-header__status" aria-live="polite">
          <span id="appStatus" class="status-chip status-chip--idle">Idle</span>
        </div>
      </div>
    </header>

    <main class="app-main" role="main">
      <div class="app-grid" aria-label="Scanner workspace">
        <section class="panel panel--left" aria-labelledby="panelLeftTitle">
          <header class="panel__header">
            <h2 id="panelLeftTitle" class="panel__title">Input &amp; Configuration</h2>
          </header>

          <div class="panel__body">
            <section class="card" aria-labelledby="buildToolTitle">
              <div class="card__title-row">
                <h3 id="buildToolTitle" class="card__title">Build tool</h3>
                <button class="tooltip" type="button" aria-label="Gradle limitation info" data-tooltip="Gradle analysis is best-effort and medium confidence in v1">i</button>
              </div>

              <div class="radio-group" role="radiogroup" aria-label="Build tool selection">
                <label class="radio">
                  <input type="radio" name="buildTool" id="buildToolMaven" value="maven" checked>
                  <span>Maven</span>
                </label>
                <label class="radio">
                  <input type="radio" name="buildTool" id="buildToolGradle" value="gradle">
                  <span>Gradle</span>
                </label>
              </div>

              <div class="form-row">
                <label class="form-label" for="buildFileContent">Project path</label>
                <textarea class="form-textarea" id="buildFileContent" name="buildFileContent" rows="2" spellcheck="false" autocomplete="off" placeholder=""></textarea>
              </div>

              <div class="meta-row" aria-label="Project path input metadata">
                <div class="meta-row__left">
                  <span class="meta" id="buildFileCharCount">0 characters</span>
                </div>
              </div>

              <div class="form-actions">
                <button type="button" id="analyzeDependencies" class="btn btn--primary">
                  <span class="btn__icon">üîç</span>
                  <span>Analyze Dependencies</span>
                </button>
                <button type="button" id="clearBuildFile" class="btn btn--ghost" style="margin-left: 8px;">
                  <span class="btn__icon">üóëÔ∏è</span>
                  <span>Clear</span>
                </button>
              </div>

              <!-- Transparency & Security Information -->
              <div class="transparency-section">
                <details class="transparency-details" open>
                  <summary class="transparency-summary">
                    <span>How This Scan Works</span>
                    <svg class="transparency-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </summary>
                  <div class="transparency-content">
                    <h4>Maven vs Gradle Analysis</h4>
                    <p>Maven provides high-confidence analysis with complete dependency resolution. Gradle analysis is best-effort due to its dynamic nature, which may result in some limitations.</p>
                    
                    <h4>Vulnerability Sources</h4>
                    <p>We check against multiple vulnerability databases including NVD, GitHub Advisories, and OSV to provide comprehensive coverage.</p>
                    
                    <h4>AI-Powered Analysis</h4>
                    <p>When enabled, AI helps contextualize findings by analyzing vulnerability patterns and potential impacts specific to your project.</p>
                  </div>
                </details>

                <details class="transparency-details">
                  <summary class="transparency-summary">
                    <span>Known Limitations</span>
                    <svg class="transparency-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </summary>
                  <div class="transparency-content">
                    <ul>
                      <li>Gradle's dynamic nature may result in some false positives/negatives</li>
                      <li>Multi-module projects may have incomplete dependency graphs</li>
                      <li>Custom dependency resolution rules may affect results</li>
                      <li>Indirect vulnerabilities may not always be detected</li>
                      <li>Version ranges may not be fully evaluated</li>
                    </ul>
                  </div>
                </details>

                <details class="transparency-details">
                  <summary class="transparency-summary">
                    <span>Data Privacy Notice</span>
                    <svg class="transparency-chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </summary>
                  <div class="transparency-content">
                    <h4>Local Processing</h4>
                    <p>Your build file and dependency tree are processed locally in your browser. No project code or sensitive information is sent to our servers.</p>
                    
                    <h4>AI Processing (if enabled)</h4>
                    <p>When AI analysis is enabled, only the following information is sent to the AI provider:</p>
                    <ul>
                      <li>Dependency names and versions</li>
                      <li>Vulnerability details from public databases</li>
                      <li>No application code or proprietary information is shared</li>
                    </ul>
                    
                    <p class="muted">We do not store any of your data permanently.</p>
                  </div>
                </details>
              </div>

              <p class="context-note" id="gradleNote" hidden>Gradle analysis is best-effort and medium confidence in v1</p>
            </section>

            <section class="card card--optional" aria-labelledby="aiOptionalTitle">
              <div class="card__title-row">
                <h3 id="aiOptionalTitle" class="card__title">AI configuration (optional)</h3>
                <label class="toggle" for="enableAI">
                  <input id="enableAI" type="checkbox">
                  <span>Enable AI-assisted analysis</span>
                </label>
              </div>

              <p class="helper">AI is optional. Core vulnerability detection works without it.</p>

              <fieldset class="optional-fieldset" id="aiFieldset" disabled>
                <div class="form-row">
                  <label class="form-label" for="aiProvider">Provider</label>
                  <select class="form-select" id="aiProvider" name="aiProvider">
                    <option value="openai" selected>OpenAI</option>
                    <option value="claude">Claude</option>
                    <option value="gemini">Gemini</option>
                    <option value="ollama">Ollama</option>
                    <option value="azure">Azure</option>
                  </select>
                </div>

                <div class="form-row">
                  <label class="form-label" for="aiApiKey">API key</label>
                  <input class="form-input" id="aiApiKey" name="aiApiKey" type="password" placeholder="(not stored)" autocomplete="off">
                </div>
              </fieldset>
            </section>

            
          </div>
        </section>

        <section class="panel panel--right" aria-labelledby="panelRightTitle">
          <header class="panel__header">
            <h2 id="panelRightTitle" class="panel__title">Results &amp; Analysis</h2>
          </header>

          <div class="panel__body">
            <section class="card" aria-labelledby="overviewTitle">
              <div class="card__title-row">
                <h3 id="overviewTitle" class="card__title">Results overview</h3>
                <div class="overview__right">
                  <span class="badge badge--confidence" id="confidenceBadge" data-tooltip="Confidence reflects how reliably we can parse and resolve dependencies for the selected build tool.">--</span>
                </div>
              </div>

              <div id="overviewEmpty" class="empty-state" role="status" aria-live="polite">
                <div class="empty-state__title">No scan yet</div>
                <div class="empty-state__body">Paste a build file and run <span class="mono">Analyze Dependencies</span> to generate results.</div>
              </div>

              <div id="overviewContent" hidden>
                <div class="overview-grid" aria-label="Summary cards">
                  <div class="kpi kpi--neutral" aria-label="Total dependencies">
                    <div class="kpi__k">Total dependencies</div>
                    <div class="kpi__v mono" id="kpiTotalDependencies">--</div>
                  </div>
                  <div class="kpi kpi--neutral" aria-label="Vulnerabilities found">
                    <div class="kpi__k">Vulnerabilities found</div>
                    <div class="kpi__v mono" id="kpiVulnsFound">--</div>
                  </div>
                  <div class="kpi kpi--bad" aria-label="Critical">
                    <div class="kpi__k">Critical</div>
                    <div class="kpi__v mono" id="kpiCritical">--</div>
                  </div>
                  <div class="kpi kpi--warn" aria-label="High">
                    <div class="kpi__k">High</div>
                    <div class="kpi__v mono" id="kpiHigh">--</div>
                  </div>
                  <div class="kpi kpi--mid" aria-label="Medium">
                    <div class="kpi__k">Medium</div>
                    <div class="kpi__v mono" id="kpiMedium">--</div>
                  </div>
                  <div class="kpi kpi--good" aria-label="Low">
                    <div class="kpi__k">Low</div>
                    <div class="kpi__v mono" id="kpiLow">--</div>
                  </div>
                  <div class="kpi kpi--neutral" aria-label="Overall risk score">
                    <div class="kpi__k">Overall risk score</div>
                    <div class="kpi__v mono" id="kpiOverallRisk">--</div>
                  </div>
                </div>

                <div class="overview-meta" aria-label="Scan metadata">
                  <div class="overview-meta__row">
                    <span class="overview-meta__k">Build tool</span>
                    <span class="overview-meta__v mono" id="metaBuildTool">--</span>
                  </div>
                  <div class="overview-meta__row">
                    <span class="overview-meta__k">Timestamp</span>
                    <span class="overview-meta__v mono" id="metaTimestamp">--</span>
                  </div>
                  <div class="overview-meta__row">
                    <span class="overview-meta__k">Vulnerability sources</span>
                    <span class="overview-meta__v" id="metaSources">--</span>
                  </div>
                </div>
              </div>

              <p class="muted" id="resultsMeta">No results loaded.</p>
            </section>

            <section class="card" aria-labelledby="tableTitle">
              <h3 id="tableTitle" class="card__title">Findings</h3>
              <div id="gradleWarning" class="alert alert--warning" hidden>
                <svg class="alert__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="12" y1="8" x2="12" y2="12"></line>
                  <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg>
                <div class="alert__content">
                  <strong>Note:</strong> Some vulnerabilities may be false positives due to Gradle resolution limitations. 
                  Review all findings carefully.
                </div>
              </div>
              
              <div class="confidence-legend">
                <div class="confidence-legend__item">
                  <span class="confidence-legend__badge confidence-legend__badge--high">HIGH</span>
                  <span class="confidence-legend__label">High confidence - Direct match in dependency tree</span>
                </div>
                <div class="confidence-legend__item">
                  <span class="confidence-legend__badge confidence-legend__badge--medium">MEDIUM</span>
                  <span class="confidence-legend__label">Medium confidence - Potential match, review recommended</span>
                </div>
                <div class="confidence-legend__item">
                  <span class="confidence-legend__badge confidence-legend__badge--low">LOW</span>
                  <span class="confidence-legend__label">Low confidence - Possible false positive</span>
                </div>
              </div>
              
              <div class="filters" aria-label="Finding filters">
                <div class="filters__row">
                  <div class="filters__group">
                    <label class="form-label" for="filterSeverity">Severity</label>
                    <select class="form-select" id="filterSeverity" name="filterSeverity">
                      <option value="all" selected>All</option>
                      <option value="CRITICAL">Critical</option>
                      <option value="HIGH">High</option>
                      <option value="MEDIUM">Medium</option>
                      <option value="LOW">Low</option>
                    </select>
                  </div>

                  <div class="filters__group">
                    <label class="form-label" for="filterDirectness">Directness</label>
                    <select class="form-select" id="filterDirectness" name="filterDirectness">
                      <option value="all" selected>All</option>
                      <option value="direct">Direct</option>
                      <option value="transitive">Transitive</option>
                    </select>
                  </div>

                  <div class="filters__group">
                    <label class="form-label" for="filterConfidence">Confidence</label>
                    <select class="form-select" id="filterConfidence" name="filterConfidence">
                      <option value="all" selected>All</option>
                      <option value="HIGH">High</option>
                      <option value="MEDIUM">Medium</option>
                      <option value="LOW">Low</option>
                    </select>
                  </div>
                </div>

                <div class="filters__row filters__row--right">
                  <span class="meta" id="findingsCount">0 findings</span>
                </div>
              </div>

              <div class="table-wrap" role="region" aria-label="Vulnerability list" tabindex="0">
                <table class="table" aria-describedby="resultsMeta">
                  <thead>
                    <tr>
                      <th scope="col">Dependency</th>
                      <th scope="col">Severity</th>
                      <th scope="col">ID</th>
                      <th scope="col">Confidence</th>
                      <th scope="col">Directness</th>
                      <th scope="col">Details</th>
                    </tr>
                  </thead>
                  <tbody id="resultsBody">
                    <tr>
                      <td class="mono" colspan="6">Run an analysis to populate findings.</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </section>

            <section class="card" aria-labelledby="analysisTitle">
              <h3 id="analysisTitle" class="card__title">Analysis</h3>
              <div class="placeholder" id="analysisPlaceholder">
                <p class="muted">Charts / timeline / remediation guidance will render here.</p>
              </div>
            </section>
          </div>
        </section>
      </div>
    </main>

    <footer class="app-footer" role="contentinfo">
      <div class="app-footer__inner">
        <span class="app-footer__version">v1.0.0</span>
        <span class="app-footer__divider" aria-hidden="true">|</span>
        <span class="app-footer__disclaimer">Results are advisory, not a substitute for manual security review</span>
      </div>
    </footer>
  </div>

  <div class="modal" id="detailsModal" hidden>
    <div class="modal__backdrop" data-close="true" aria-hidden="true"></div>
    <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="detailsTitle">
      <div class="modal__header">
        <div class="modal__title-wrap">
          <div class="modal__title" id="detailsTitle">Finding details</div>
          <div class="modal__subtitle mono" id="detailsDependency">--</div>
        </div>
        <button class="btn btn--ghost" type="button" id="closeDetails" aria-label="Close">Close</button>
      </div>

      <div class="modal__body">
        <div class="details-chips" aria-label="Finding tags">
          <span class="pill pill--severity" id="detailsSeverity">--</span>
          <span class="pill" id="detailsId">--</span>
          <span class="pill" id="detailsConfidence">Confidence: --</span>
          <span class="pill" id="detailsDirectness">--</span>
          <span class="pill" id="detailsSource">Source: --</span>
        </div>

        <section class="details-section" aria-labelledby="descTitle">
          <h4 class="details-section__title" id="descTitle">Description</h4>
          <p class="details-section__text" id="detailsDescription">--</p>
        </section>

        <section class="details-section" aria-labelledby="affectedTitle">
          <h4 class="details-section__title" id="affectedTitle">Affected versions</h4>
          <div class="code-block" id="detailsAffected">--</div>
        </section>

        <section class="details-section" aria-labelledby="pathTitle">
          <h4 class="details-section__title" id="pathTitle">Dependency path</h4>
          <pre class="dep-tree" id="detailsPath">--</pre>
        </section>

        <section class="details-section" aria-labelledby="explainTitle">
          <div class="details-section__title-row">
            <h4 class="details-section__title" id="explainTitle">Risk explanation</h4>
            <span class="explain-badge" id="detailsExplainType">--</span>
          </div>
          <p class="details-section__text" id="detailsExplanation">--</p>
        </section>
      </div>
    </div>
  </div>

  <div class="overlay" id="loadingOverlay" hidden>
    <div class="overlay__card" role="status" aria-live="polite">
      <div class="spinner" aria-hidden="true"></div>
      <div class="overlay__text" id="loadingText">Working...</div>
    </div>
  </div>

  <script src="/app.js?v=1" defer></script>
</body>
</html>
